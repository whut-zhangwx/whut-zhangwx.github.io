<!DOCTYPE html><html class="hide-aside" lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL学习笔记 | 文羊羽</title><meta name="author" content="文羊羽"><meta name="copyright" content="文羊羽"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MySQL安装配置   MySQL官网   史上MySQL安装配置教程最细，一步一图解 | CSDN   下载 Community 版本MySQL Community Server，选择 Recommended Download，下载 Windows (x86, 32-bit), MSI Installer (包含 64 位版本)   安装完成后在最近安装中可以找到 MySQL8.0 Comman">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL学习笔记">
<meta property="og:url" content="https://whut-zhangwx.github.io/database-mysql/index.html">
<meta property="og:site_name" content="文羊羽">
<meta property="og:description" content="MySQL安装配置   MySQL官网   史上MySQL安装配置教程最细，一步一图解 | CSDN   下载 Community 版本MySQL Community Server，选择 Recommended Download，下载 Windows (x86, 32-bit), MSI Installer (包含 64 位版本)   安装完成后在最近安装中可以找到 MySQL8.0 Comman">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://whut-zhangwx.github.io/white">
<meta property="article:published_time" content="2022-07-12T16:00:00.000Z">
<meta property="article:modified_time" content="2023-05-26T13:08:56.681Z">
<meta property="article:author" content="文羊羽">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://whut-zhangwx.github.io/white"><link rel="shortcut icon" href="/img/avatar.jpg"><link rel="canonical" href="https://whut-zhangwx.github.io/database-mysql/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-26 21:08:56'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">71</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">81</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background: white"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">文羊羽</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-07-12T16:00:00.000Z" title="发表于 2022-07-13 00:00:00">2022-07-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-26T13:08:56.681Z" title="更新于 2023-05-26 21:08:56">2023-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>45分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="mysql安装配置">MySQL安装配置</h2>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://www.mysql.com/">MySQL官网</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39652397/article/details/124022739">史上MySQL安装配置教程最细，一步一图解 | CSDN</a></p>
</li>
<li>
<p>下载 Community 版本<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/mysql/">MySQL Community Server</a>，选择 Recommended Download，下载 <a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/windows/installer/8.0.html">Windows (x86, 32-bit), MSI Installer</a> (包含 64 位版本)</p>
</li>
<li>
<p>安装完成后在最近安装中可以找到 <code>MySQL8.0 Command Line Clinet</code>，进入提示输入密码则安装成功</p>
</li>
<li>
<p>添加环境变量：在系统变量 path 中添加 bin 文件夹的路径 <code>D:\Program Files\MySQL\MySQL Server 8.0\bin</code><br>
cmd 中输入 <code>mysql -u root -p</code>，提示输入密码则环境变量配置成功</p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://dbeaver.io/">DBeaver Community</a></p>
</li>
</ul>
<h2 id="基本语法">基本语法</h2>
<ul>
<li>
<p>登录和退出MySQL服务器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">登录MySQL</span></span><br><span class="line">mysql -u root -p </span><br><span class="line">Enter password: ******</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">其中 -u 指的是用户名 (root), -p 指的是密码</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以选择直接输入密码</span></span><br><span class="line">mysql -u root -p******</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">区别是直接输入密码, 密码会显示在屏幕上</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">退出MySQL数据库服务器</span></span><br><span class="line">exit; #这里可以不用加;分号</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>显示数据库服务器中的所有数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases; #注意加分号</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> Database           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br><span class="line"><span class="operator">|</span> information_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> mysql              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> performance_schema <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sys                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在数据库服务器中创建新的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE <span class="operator">&lt;</span>DATABASE_NAME<span class="operator">&gt;</span>; #不必大写</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除已有的数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> DATABASE <span class="operator">&lt;</span>DATABASE_NAME<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>切换数据库</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use <span class="operator">&lt;</span>DATABASE_NAME<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>显示数据库中的所有表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>创建数据表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="operator">&lt;</span>TABLE_NAME<span class="operator">&gt;</span> (</span><br><span class="line">  <span class="operator">&lt;</span>字段<span class="operator">&gt;</span> 数据类型</span><br><span class="line">    <span class="operator">&lt;</span>字段<span class="operator">&gt;</span> 数据类型</span><br><span class="line">      ......</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个名为pet的表格</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> pet (</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     owner <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     species <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     sex <span class="type">CHAR</span>(<span class="number">1</span>),</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     birth <span class="type">DATE</span>,</span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span>     death <span class="type">DATE</span></span><br><span class="line">    <span class="operator">-</span><span class="operator">&gt;</span> );</span><br><span class="line"></span><br><span class="line"># 查看全部表格</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_test <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br><span class="line"><span class="operator">|</span> pet            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查看数据表结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">describe</span> <span class="operator">&lt;</span>TABLE_NAME<span class="operator">&gt;</span>;</span><br><span class="line"><span class="keyword">desc</span> <span class="operator">&lt;</span>TABLE_NAME<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">describe</span> pet;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field   <span class="operator">|</span> Type        <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> name    <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> owner   <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> species <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">20</span>) <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sex     <span class="operator">|</span> <span class="type">char</span>(<span class="number">1</span>)     <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> birth   <span class="operator">|</span> <span class="type">date</span>        <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> death   <span class="operator">|</span> <span class="type">date</span>        <span class="operator">|</span> YES  <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+-------------+------+-----+---------+-------+</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>查询表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">from</span> pet;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>插入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br><span class="line"></span><br><span class="line"># 指定字段</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name (column1,column2,column3,...)</span><br><span class="line"><span class="keyword">VALUES</span> (value1,value2,value3,...);</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 插入数据</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> pet <span class="keyword">VALUES</span> (<span class="string">&#x27;puffball&#x27;</span>, <span class="string">&#x27;Diane&#x27;</span>, <span class="string">&#x27;hamster&#x27;</span>, <span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;1990-03-30&#x27;</span>, <span class="keyword">NULL</span>);</span><br><span class="line"></span><br><span class="line"># 查询数据</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span>  pet;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------+---------+------+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> name     <span class="operator">|</span> owner <span class="operator">|</span> species <span class="operator">|</span> sex  <span class="operator">|</span> birth      <span class="operator">|</span> death <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------+---------+------+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> puffball <span class="operator">|</span> Diane <span class="operator">|</span> hamster <span class="operator">|</span> f    <span class="operator">|</span> <span class="number">1990</span><span class="number">-03</span><span class="number">-30</span> <span class="operator">|</span> <span class="keyword">NULL</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+-------+---------+------+------------+-------+</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>修改数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> pet <span class="keyword">SET</span> name <span class="operator">=</span> <span class="string">&#x27;puffball&#x27;</span> <span class="keyword">where</span> owner <span class="operator">=</span> <span class="string">&#x27;Duff&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> pet <span class="keyword">where</span> name <span class="operator">=</span> <span class="string">&#x27;puffball&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>删除表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> pet;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="mysql常用数据类型">MySQL常用数据类型</h2>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-data-types.html">MySQL 数据类型 | 菜鸟教程</a></p>
<ul>
<li>数值类型</li>
<li>时间类型</li>
<li>字符串类型</li>
</ul>
<p>按照时间格式选择合适的时间类型，按照需要数值和字符串范围选择合适的数值和字符串类型</p>
<h2 id="建表约束">建表约束</h2>
<h3 id="主键约束">主键约束</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 主键约束</span></span><br><span class="line"><span class="comment">-- 使某个字段不重复且不得为空，确保表内所有数据的唯一性。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 联合主键</span></span><br><span class="line"><span class="comment">-- 联合主键中的每个字段都不能为空，并且联合起来不重复。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    password <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(id, name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 自增约束</span></span><br><span class="line"><span class="comment">-- 自增约束的主键由系统自动递增分配。</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加主键约束</span></span><br><span class="line"><span class="comment">-- 如果忘记设置主键，还可以通过SQL语句设置（两种方式）：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY(id);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name MODIFY id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> table_name <span class="keyword">drop</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>
<h3 id="唯一约束">唯一约束</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表时创建唯一约束</span></span><br><span class="line"><span class="comment">-- 唯一约束不可重复，可以为空</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span>(name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 建表时创建联合唯一约束</span></span><br><span class="line"><span class="comment">-- 联合唯一约束联合起来不可重复，可以为空</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span>(id,name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加唯一主键</span></span><br><span class="line"><span class="comment">-- 如果建表时没有设置唯一建，还可以通过SQL语句设置（两种方式）：</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(name);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> MODIFY name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除唯一主键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> <span class="keyword">DROP</span> INDEX name;</span><br></pre></td></tr></table></figure>
<h3 id="非空约束">非空约束</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表时添加非空约束</span></span><br><span class="line"><span class="comment">-- 约束某个字段不能为空</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除非空约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> MODIFY name <span class="type">VARCHAR</span>(<span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<h3 id="默认约束">默认约束</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建表时添加默认约束</span></span><br><span class="line"><span class="comment">-- 约束某个字段的默认值</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> user2 (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    age <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">10</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 移除非空约束</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> MODIFY age <span class="type">INT</span>;</span><br></pre></td></tr></table></figure>
<h3 id="外键约束">外键约束</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 班级</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> classes (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 学生表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> students (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="comment">-- 这里的 class_id 要和 classes 中的 id 字段相关联</span></span><br><span class="line">    class_id <span class="type">INT</span>,</span><br><span class="line">    <span class="comment">-- 表示 class_id 的值必须来自于 classes 中的 id 字段值</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY(class_id) <span class="keyword">REFERENCES</span> classes(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1. 主表（父表）classes 中没有的数据值，在副表（子表）students 中，是不可以使用的；</span></span><br><span class="line"><span class="comment">-- 2. 主表中的记录被副表引用时，主表不可以被删除。</span></span><br></pre></td></tr></table></figure>
<h2 id="数据库的三大设计范式">数据库的三大设计范式</h2>
<h3 id="1nf">1NF</h3>
<p>第一范式是数据表中的所有字段都是不可分割的原子值，只要字段值还可以继续拆分，就不满足第一范式。</p>
<p>字段设计得越详细，对某些实际操作可能会更好，但并非都有好处，需要对项目的实际情况进行设定。</p>
<h3 id="2nf">2NF</h3>
<p>在满足第一范式的前提下，其他列都必须完全依赖于主键列。如果出现不完全依赖，只可能发生在联合主键的情况下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 订单表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    customer_id <span class="type">INT</span>,</span><br><span class="line">    product_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    customer_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (product_id, customer_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>实际上，在这张订单表中，<code>product_name</code> 只依赖于 <code>product_id</code> ，<code>customer_name</code> 只依赖于 <code>customer_id</code> 。也就是说，<code>product_name</code> 和 <code>customer_id</code> 是没用关系的，<code>customer_name</code> 和 <code>product_id</code> 也是没有关系的。</p>
<p>这就不满足第二范式：除主键外的其他列，只依赖了主键的部分字段，不是完全依赖于主键。此时就需要拆表，重新设计。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    customer_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>拆分成三个表之后，<code>myorder</code> 表中的 <code>product_id</code> 和 <code>customer_id</code> 完全依赖于 <code>order_id</code> 主键，而 <code>product</code> 和 <code>customer</code> 表中的其他字段又完全依赖于主键。满足了第二范式的设计！</p>
<h3 id="3nf">3NF</h3>
<p>在满足第二范式的前提下，除了主键列之外，其他列之间不能有传递依赖关系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    customer_id <span class="type">INT</span>,</span><br><span class="line">    customer_phone <span class="type">VARCHAR</span>(<span class="number">15</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>表中的 <code>customer_phone</code> 有依赖于 <code>order_id</code> 和 <code>customer_id</code> 两列，这样就有了冗余的设计，也就不满足了第三范式的设计要求：其他列之间不能有传递依赖关系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myorder (</span><br><span class="line">    order_id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    product_id <span class="type">INT</span>,</span><br><span class="line">    customer_id <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    phone <span class="type">VARCHAR</span>(<span class="number">15</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>修改后就不存在其他列之间的传递依赖关系，其他列都只依赖于主键列，满足了第三范式的设计！</p>
<h2 id="查询练习">查询练习</h2>
<h3 id="准备数据">准备数据</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">CREATE</span> DATABASE select_test;</span><br><span class="line"><span class="comment">-- 切换数据库</span></span><br><span class="line">USE select_test;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建学生表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student (</span><br><span class="line">    <span class="keyword">no</span> <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    sex <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    birthday <span class="type">DATE</span>, <span class="comment">-- 生日</span></span><br><span class="line">    class <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="comment">-- 所在班级</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建教师表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> teacher (</span><br><span class="line">    <span class="keyword">no</span> <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    sex <span class="type">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    birthday <span class="type">DATE</span>,</span><br><span class="line">    profession <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 职称</span></span><br><span class="line">    department <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="comment">-- 部门</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建课程表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> course (</span><br><span class="line">    <span class="keyword">no</span> <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    t_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 教师编号</span></span><br><span class="line">    <span class="comment">-- 表示该 tno 来自于 teacher 表中的 no 字段值</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY(t_no) <span class="keyword">REFERENCES</span> teacher(<span class="keyword">no</span>) </span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 成绩表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> score (</span><br><span class="line">    s_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 学生编号</span></span><br><span class="line">    c_no <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- 课程号</span></span><br><span class="line">    degree <span class="type">DECIMAL</span>, <span class="comment">-- 成绩</span></span><br><span class="line">    <span class="comment">-- 表示该 s_no, c_no 分别来自于 student, course 表中的 no 字段值</span></span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY(s_no) <span class="keyword">REFERENCES</span> student(<span class="keyword">no</span>),</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY(c_no) <span class="keyword">REFERENCES</span> course(<span class="keyword">no</span>),</span><br><span class="line">    <span class="comment">-- 设置 s_no, c_no 为联合主键</span></span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY(s_no, c_no)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看所有表</span></span><br><span class="line"><span class="keyword">SHOW</span> TABLES;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加学生表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;曾华&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1977-09-01&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;102&#x27;</span>, <span class="string">&#x27;匡明&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1975-10-02&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;王丽&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1976-01-23&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;104&#x27;</span>, <span class="string">&#x27;李军&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1976-02-20&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;王芳&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1975-02-10&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;106&#x27;</span>, <span class="string">&#x27;陆军&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1974-06-03&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;107&#x27;</span>, <span class="string">&#x27;王尼玛&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1976-02-20&#x27;</span>, <span class="string">&#x27;95033&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;108&#x27;</span>, <span class="string">&#x27;张全蛋&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1975-02-10&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> student <span class="keyword">VALUES</span>(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;赵铁柱&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1974-06-03&#x27;</span>, <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加教师表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">&#x27;804&#x27;</span>, <span class="string">&#x27;李诚&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1958-12-02&#x27;</span>, <span class="string">&#x27;副教授&#x27;</span>, <span class="string">&#x27;计算机系&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">&#x27;856&#x27;</span>, <span class="string">&#x27;张旭&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1969-03-12&#x27;</span>, <span class="string">&#x27;讲师&#x27;</span>, <span class="string">&#x27;电子工程系&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">&#x27;825&#x27;</span>, <span class="string">&#x27;王萍&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1972-05-05&#x27;</span>, <span class="string">&#x27;助教&#x27;</span>, <span class="string">&#x27;计算机系&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> teacher <span class="keyword">VALUES</span>(<span class="string">&#x27;831&#x27;</span>, <span class="string">&#x27;刘冰&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;1977-08-14&#x27;</span>, <span class="string">&#x27;助教&#x27;</span>, <span class="string">&#x27;电子工程系&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加课程表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;计算机导论&#x27;</span>, <span class="string">&#x27;825&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">&#x27;3-245&#x27;</span>, <span class="string">&#x27;操作系统&#x27;</span>, <span class="string">&#x27;804&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">&#x27;6-166&#x27;</span>, <span class="string">&#x27;数字电路&#x27;</span>, <span class="string">&#x27;856&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> course <span class="keyword">VALUES</span>(<span class="string">&#x27;9-888&#x27;</span>, <span class="string">&#x27;高等数学&#x27;</span>, <span class="string">&#x27;831&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 添加添加成绩表数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;92&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;3-245&#x27;</span>, <span class="string">&#x27;86&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;103&#x27;</span>, <span class="string">&#x27;6-166&#x27;</span>, <span class="string">&#x27;85&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;88&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;3-245&#x27;</span>, <span class="string">&#x27;75&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;105&#x27;</span>, <span class="string">&#x27;6-166&#x27;</span>, <span class="string">&#x27;79&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;76&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;3-245&#x27;</span>, <span class="string">&#x27;68&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span>(<span class="string">&#x27;109&#x27;</span>, <span class="string">&#x27;6-166&#x27;</span>, <span class="string">&#x27;81&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表格数据</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> course;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher;</span><br></pre></td></tr></table></figure>
<h3 id="练习1-到-10">练习1 到 10</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.查询 student 表的所有行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 2.查询 student 表中的 name、sex 和 class 字段的所有行</span></span><br><span class="line"><span class="keyword">SELECT</span> name, sex, class <span class="keyword">FROM</span> student;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 3.去重查询：查询 teacher 表中 department 列的不重复值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department <span class="keyword">FROM</span> teacher;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 4.查询 score 表中成绩在60-80之间的所有行（区间查询和运算符查询）</span></span><br><span class="line"><span class="comment">-- BETWEEN xx AND xx: 查询区间, AND 表示 &quot;并且&quot;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="keyword">BETWEEN</span> <span class="number">60</span> <span class="keyword">AND</span> <span class="number">80</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="operator">&gt;</span> <span class="number">60</span> <span class="keyword">AND</span> degree <span class="operator">&lt;</span> <span class="number">80</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5.查询 score 表中成绩为 85, 86 或 88 的行</span></span><br><span class="line"><span class="comment">-- IN: 查询规定中的多个值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="keyword">IN</span> (<span class="number">85</span>, <span class="number">86</span>, <span class="number">88</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 6.查询 student 表中 &#x27;95031&#x27; 班或性别为 &#x27;女&#x27; 的所有行</span></span><br><span class="line"><span class="comment">-- or: 表示或者关系</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;95031&#x27;</span> <span class="keyword">or</span> sex <span class="operator">=</span> <span class="string">&#x27;女&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 7.以 class 降序的方式查询 student 表的所有行</span></span><br><span class="line"><span class="comment">-- DESC: 降序，从高到低</span></span><br><span class="line"><span class="comment">-- ASC（默认）: 升序，从低到高</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> class <span class="keyword">DESC</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> class <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 8.以 c_no 升序、degree 降序查询 score 表的所有行</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">ORDER</span> <span class="keyword">BY</span> c_no <span class="keyword">ASC</span>, degree <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 9.查询 &quot;95031&quot; 班的学生人数</span></span><br><span class="line"><span class="comment">-- COUNT: 统计</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;95031&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10-1.查询 score 表中的最高分的学生学号和课程编号（子查询或排序查询）。</span></span><br><span class="line"><span class="comment">-- (SELECT MAX(degree) FROM score): 子查询，算出最高分</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(degree) <span class="keyword">FROM</span> score);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 10-2.排序查询</span></span><br><span class="line"><span class="comment">-- LIMIT r, n: 表示从第r行开始，查询n条数据</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score <span class="keyword">ORDER</span> <span class="keyword">BY</span> degree <span class="keyword">DESC</span> LIMIT <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"># <span class="number">0</span>,<span class="number">1</span>表示从<span class="number">0</span>开始查询<span class="number">1</span>条</span><br></pre></td></tr></table></figure>
<h3 id="分组计算平均成绩">分组计算平均成绩</h3>
<p><strong>11.查询每门课的平均成绩。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- AVG: 平均值</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-245&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;6-166&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- GROUP BY: 分组查询</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no;</span><br></pre></td></tr></table></figure>
<h3 id="分组条件与模糊查询">分组条件与模糊查询</h3>
<p><strong>12.查询 <code>score</code> 表中至少有 2 名学生选修，并以 3 开头的课程的平均分数。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="comment">-- c_no 课程编号</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>分析表发现，至少有 2 名学生选修的课程是 <code>3-105</code> 、<code>3-245</code> 、<code>6-166</code> ，以 3 开头的课程是 <code>3-105</code> 、<code>3-245</code> 。也就是说，我们要查询所有 <code>3-105</code> 和 <code>3-245</code> 的 <code>degree</code> 平均分。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 首先把 c_no, AVG(degree) 通过分组查询出来</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> c_no  <span class="operator">|</span> <span class="built_in">AVG</span>(degree) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">85.3333</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">76.3333</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81.6667</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再查询出至少有 2 名学生选修的课程</span></span><br><span class="line"><span class="comment">-- HAVING: 表示持有</span></span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(c_no) <span class="operator">&gt;=</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 并且是以 3 开头的课程</span></span><br><span class="line"><span class="comment">-- LIKE 表示模糊查询，&quot;%&quot; 是一个通配符，匹配 &quot;3&quot; 后面的任意字符。</span></span><br><span class="line"><span class="keyword">AND</span> c_no <span class="keyword">LIKE</span> <span class="string">&#x27;3%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 把前面的SQL语句拼接起来，</span></span><br><span class="line"><span class="comment">-- 后面加上一个 COUNT(*)，表示将每个分组的个数也查询出来。</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="built_in">AVG</span>(degree), <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(c_no) <span class="operator">&gt;=</span> <span class="number">2</span> <span class="keyword">AND</span> c_no <span class="keyword">LIKE</span> <span class="string">&#x27;3%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+----------+</span></span><br><span class="line"><span class="operator">|</span> c_no  <span class="operator">|</span> <span class="built_in">AVG</span>(degree) <span class="operator">|</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">85.3333</span> <span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">76.3333</span> <span class="operator">|</span>        <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+----------+</span></span><br></pre></td></tr></table></figure>
<h3 id="多表查询-1">多表查询 - 1</h3>
<p><strong>13.查询所有学生的 <code>no</code> 、课程名称 ( <code>course</code> 表中的 <code>name</code> ) 和成绩 ( <code>score</code> 表中的 <code>degree</code> ) 列。</strong></p>
<p>只有 <code>score</code> 关联学生的 <code>no</code> ，因此只要查询 <code>score</code> 表，就能找出所有和学生相关的 <code>no</code> 和 <code>degree</code> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>然后查询 <code>course</code> 表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>    <span class="operator">|</span> name            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> 计算机导论      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> 操作系统        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> 数字电路        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span><span class="number">-888</span> <span class="operator">|</span> 高等数学        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+</span></span><br></pre></td></tr></table></figure>
<p>只要把 <code>score</code> 表中的 <code>c_no</code> 替换成 <code>course</code> 表中对应的 <code>name</code> 字段值就可以了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 增加一个查询字段 name，分别从 score、course 这两个表中查询。</span></span><br><span class="line"><span class="comment">-- as 表示取一个该字段的别名。</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, name <span class="keyword">as</span> c_name, degree <span class="keyword">FROM</span> score, course</span><br><span class="line"><span class="keyword">WHERE</span> score.c_no <span class="operator">=</span> course.no;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_name          <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> 计算机导论      <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> 计算机导论      <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> 计算机导论      <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> 操作系统        <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> 操作系统        <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> 操作系统        <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> 数字电路        <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> 数字电路        <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> 数字电路        <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="多表查询-2">多表查询 - 2</h3>
<p><strong>14.查询所有学生的 <code>name</code>，以及该学生在 <code>score</code> 表中对应的 <code>c_no</code> 和 <code>degree</code> 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, name <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>  <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> 曾华      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> 匡明      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span> <span class="operator">|</span> 王丽      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span> <span class="operator">|</span> 李军      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span> <span class="operator">|</span> 王芳      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">106</span> <span class="operator">|</span> 陆军      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">107</span> <span class="operator">|</span> 王尼玛    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">108</span> <span class="operator">|</span> 张全蛋    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span> <span class="operator">|</span> 赵铁柱    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>通过分析可以发现，只要把 <code>score</code> 表中的 <code>s_no</code> 字段值替换成 <code>student</code> 表中对应的 <code>name</code> 字段值就可以了，如何做呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- FROM...: 表示从 student, score 表中查询</span></span><br><span class="line"><span class="comment">-- WHERE 的条件表示为，只有在 student.no 和 score.s_no 相等时才显示出来。</span></span><br><span class="line"><span class="keyword">SELECT</span> name, c_no, degree <span class="keyword">FROM</span> student, score </span><br><span class="line"><span class="keyword">WHERE</span> student.no <span class="operator">=</span> score.s_no;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> name      <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="三表关联查询">三表关联查询</h3>
<p><strong>16.查询所有学生的 <code>name</code> 、课程名 ( <code>course</code> 表中的 <code>name</code> ) 和 <code>degree</code> 。</strong></p>
<p>只有 <code>score</code> 表中关联学生的学号和课堂号，我们只要围绕着 <code>score</code> 这张表查询就好了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>只要把 <code>s_no</code> 和 <code>c_no</code> 替换成 <code>student</code> 和 <code>srouse</code> 表中对应的 <code>name</code> 字段值就好了。</p>
<p>首先把 <code>s_no</code> 替换成 <code>student</code> 表中的 <code>name</code> 字段：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, c_no, degree <span class="keyword">FROM</span> student, score <span class="keyword">WHERE</span> student.no <span class="operator">=</span> score.s_no;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> name      <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>再把 <code>c_no</code> 替换成 <code>course</code> 表中的 <code>name</code> 字段：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 课程表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, name <span class="keyword">FROM</span> course;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>    <span class="operator">|</span> name            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> 计算机导论      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> 操作系统        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> 数字电路        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span><span class="number">-888</span> <span class="operator">|</span> 高等数学        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于字段名存在重复，使用 &quot;表名.字段名 as 别名&quot; 代替。</span></span><br><span class="line"><span class="keyword">SELECT</span> student.name <span class="keyword">as</span> s_name, course.name <span class="keyword">as</span> c_name, degree </span><br><span class="line"><span class="keyword">FROM</span> student, score, course</span><br><span class="line"><span class="keyword">WHERE</span> student.NO <span class="operator">=</span> score.s_no</span><br><span class="line"><span class="keyword">AND</span> score.c_no <span class="operator">=</span> course.no;</span><br></pre></td></tr></table></figure>
<h3 id="子查询加分组求平均分">子查询加分组求平均分</h3>
<p><strong>查询 <code>95031</code> 班学生每门课程的平均成绩。</strong></p>
<p>在 <code>score</code> 表中根据 <code>student</code>  表的学生编号筛选出学生的课堂号和成绩：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- IN (..): 将筛选出的学生号当做 s_no 的条件查询</span></span><br><span class="line"><span class="keyword">SELECT</span> s_no, c_no, degree <span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> s_no <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;95031&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>这时只要将 <code>c_no</code> 分组一下就能得出 <code>95031</code> 班学生每门课的平均成绩：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> c_no, <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> s_no <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> class <span class="operator">=</span> <span class="string">&#x27;95031&#x27;</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> c_no  <span class="operator">|</span> <span class="built_in">AVG</span>(degree) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">82.0000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">71.5000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">80.0000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="子查询-1">子查询 - 1</h3>
<p><strong>查询在 <code>3-105</code> 课程中，所有成绩高于 <code>109</code> 号同学的记录。</strong></p>
<p>首先筛选出课堂号为 <code>3-105</code> ，在找出所有成绩高于 <code>109</code> 号同学的的行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score </span><br><span class="line"><span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span></span><br><span class="line"><span class="keyword">AND</span> degree <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> s_no <span class="operator">=</span> <span class="string">&#x27;109&#x27;</span> <span class="keyword">AND</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="子查询-2">子查询 - 2</h3>
<p><strong>查询所有成绩高于 <code>109</code> 号同学的 <code>3-105</code> 课程成绩记录。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 不限制课程号，只要成绩大于109号同学的3-105课程成绩就可以。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score</span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> s_no <span class="operator">=</span> <span class="string">&#x27;109&#x27;</span> <span class="keyword">AND</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="year-函数与带-in-关键字查询">YEAR 函数与带 IN 关键字查询</h3>
<p><strong>查询所有和 <code>101</code> 、<code>108</code> 号学生同年出生的 <code>no</code> 、<code>name</code> 、<code>birthday</code> 列。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- YEAR(..): 取出日期中的年份</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, name, birthday <span class="keyword">FROM</span> student</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(birthday) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(birthday) <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (<span class="number">101</span>, <span class="number">108</span>));</span><br></pre></td></tr></table></figure>
<h3 id="多层嵌套子查询">多层嵌套子查询</h3>
<p><strong>查询 <code>'张旭'</code> 教师任课的学生成绩表。</strong></p>
<p>首先找到教师编号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NO</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;张旭&#x27;</span></span><br></pre></td></tr></table></figure>
<p>通过 <code>sourse</code> 表找到该教师课程号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NO</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="operator">=</span> ( <span class="keyword">SELECT</span> <span class="keyword">NO</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;张旭&#x27;</span> );</span><br></pre></td></tr></table></figure>
<p>通过筛选出的课程号查询成绩表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="operator">=</span> ( </span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> NAME <span class="operator">=</span> <span class="string">&#x27;张旭&#x27;</span> </span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="多表查询">多表查询</h3>
<p><strong>查询某选修课程多于5个同学的教师姓名。</strong></p>
<p>首先在 <code>teacher</code> 表中，根据 <code>no</code> 字段来判断该教师的同一门课程是否有至少5名学员选修：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询 teacher 表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, name <span class="keyword">FROM</span> teacher;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>  <span class="operator">|</span> name   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">804</span> <span class="operator">|</span> 李诚   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">825</span> <span class="operator">|</span> 王萍   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">831</span> <span class="operator">|</span> 刘冰   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">856</span> <span class="operator">|</span> 张旭   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="comment">-- 在这里找到对应的条件</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>查看和教师编号有有关的表的信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> course;</span><br><span class="line"><span class="comment">-- t_no: 教师编号</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>    <span class="operator">|</span> name            <span class="operator">|</span> t_no <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> 计算机导论      <span class="operator">|</span> <span class="number">825</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> 操作系统        <span class="operator">|</span> <span class="number">804</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> 数字电路        <span class="operator">|</span> <span class="number">856</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">9</span><span class="number">-888</span> <span class="operator">|</span> 高等数学        <span class="operator">|</span> <span class="number">831</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-----------------+------+</span></span><br></pre></td></tr></table></figure>
<p>我们已经找到和教师编号有关的字段就在 <code>course</code> 表中，但是还无法知道哪门课程至少有5名学生选修，所以还需要根据 <code>score</code> 表来查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在此之前向 score 插入一些数据，以便丰富查询条件。</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span> (<span class="string">&#x27;101&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;90&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span> (<span class="string">&#x27;102&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;91&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> score <span class="keyword">VALUES</span> (<span class="string">&#x27;104&#x27;</span>, <span class="string">&#x27;3-105&#x27;</span>, <span class="string">&#x27;89&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在 score 表中将 c_no 作为分组，并且限制 c_no 持有至少 5 条数据。</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> c_no  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br></pre></td></tr></table></figure>
<p>根据筛选出来的课程号，找出在某课程中，拥有至少5名学员的教师编号：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> t_no <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> c_no <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> t_no <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">825</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br></pre></td></tr></table></figure>
<p>在 <code>teacher</code> 表中，根据筛选出来的教师编号找到教师姓名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="comment">-- 最终条件</span></span><br><span class="line">    <span class="keyword">SELECT</span> t_no <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> c_no <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">5</span></span><br><span class="line">    )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="子查询-3">子查询 - 3</h3>
<p><strong>查询 “计算机系” 课程的成绩表。</strong></p>
<p>思路是，先找出 <code>course</code> 表中所有 <code>计算机系</code> 课程的编号，然后根据这个编号查询 <code>score</code> 表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 通过 teacher 表查询所有 `计算机系` 的教师编号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span>, name, department <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;计算机系&#x27;</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+--------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>  <span class="operator">|</span> name   <span class="operator">|</span> department   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+--------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">804</span> <span class="operator">|</span> 李诚   <span class="operator">|</span> 计算机系     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">825</span> <span class="operator">|</span> 王萍   <span class="operator">|</span> 计算机系     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+--------+--------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过 course 表查询该教师的课程编号</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;计算机系&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据筛选出来的课程号查询成绩表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;计算机系&#x27;</span></span><br><span class="line">    )</span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="union-和-notin-的使用">UNION 和 NOTIN 的使用</h3>
<p><strong>查询 <code>计算机系</code> 与 <code>电子工程系</code> 中的不同职称的教师。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- NOT: 代表逻辑非</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;计算机系&#x27;</span> <span class="keyword">AND</span> profession <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> profession <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;电子工程系&#x27;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 合并两个集</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;电子工程系&#x27;</span> <span class="keyword">AND</span> profession <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> profession <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> department <span class="operator">=</span> <span class="string">&#x27;计算机系&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="any-表示至少一个-desc-降序">ANY 表示至少一个 - DESC ( 降序 )</h3>
<p><strong>查询课程 <code>3-105</code> 且成绩 <u>至少</u> 高于 <code>3-245</code> 的 <code>score</code> 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-245&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ANY: 符合SQL语句中的任意条件。</span></span><br><span class="line"><span class="comment">-- 也就是说，在 3-105 成绩中，只要有一个大于从 3-245 筛选出来的任意行就符合条件，</span></span><br><span class="line"><span class="comment">-- 最后根据降序查询结果。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span> <span class="keyword">AND</span> degree <span class="operator">&gt;</span> <span class="keyword">ANY</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-245&#x27;</span></span><br><span class="line">) <span class="keyword">ORDER</span> <span class="keyword">BY</span> degree <span class="keyword">DESC</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="表示所有的-all">表示所有的 ALL</h3>
<p><strong>查询课程 <code>3-105</code> 且成绩高于 <code>3-245</code> 的 <code>score</code> 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 只需对上一道题稍作修改。</span></span><br><span class="line"><span class="comment">-- ALL: 符合SQL语句中的所有条件。</span></span><br><span class="line"><span class="comment">-- 也就是说，在 3-105 每一行成绩中，都要大于从 3-245 筛选出来全部行才算符合条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-105&#x27;</span> <span class="keyword">AND</span> degree <span class="operator">&gt;</span> <span class="keyword">ALL</span>(</span><br><span class="line">    <span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> <span class="string">&#x27;3-245&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="复制表的数据作为条件查询">复制表的数据作为条件查询</h3>
<p><strong>查询某课程成绩比该课程平均成绩低的 <code>score</code> 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询平均分</span></span><br><span class="line"><span class="keyword">SELECT</span> c_no, <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score <span class="keyword">GROUP</span> <span class="keyword">BY</span> c_no;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> c_no  <span class="operator">|</span> <span class="built_in">AVG</span>(degree) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">87.6667</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">76.3333</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81.6667</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询 score 表</span></span><br><span class="line"><span class="keyword">SELECT</span> degree <span class="keyword">FROM</span> score;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"><span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">86</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">85</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">88</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将表 b 作用于表 a 中查询数据</span></span><br><span class="line"><span class="comment">-- score a (b): 将表声明为 a (b)，</span></span><br><span class="line"><span class="comment">-- 如此就能用 a.c_no = b.c_no 作为条件执行查询了。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score a <span class="keyword">WHERE</span> degree <span class="operator">&lt;</span> (</span><br><span class="line">    (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(degree) <span class="keyword">FROM</span> score b <span class="keyword">WHERE</span> a.c_no <span class="operator">=</span> b.c_no)</span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">75</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">79</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span>     <span class="number">68</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span>     <span class="number">81</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="子查询-4">子查询 - 4</h3>
<p><strong>查询所有任课 ( 在 <code>course</code> 表里有课程 ) 教师的 <code>name</code> 和 <code>department</code></strong> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, department <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> <span class="keyword">no</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t_no <span class="keyword">FROM</span> course);</span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> name   <span class="operator">|</span> department      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> 李诚   <span class="operator">|</span> 计算机系        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王萍   <span class="operator">|</span> 计算机系        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 刘冰   <span class="operator">|</span> 电子工程系      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 张旭   <span class="operator">|</span> 电子工程系      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------+-----------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="条件加组筛选">条件加组筛选</h3>
<p><strong>查询 <code>student</code> 表中至少有 2 名男生的 <code>class</code> 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看学生表信息</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>  <span class="operator">|</span> name      <span class="operator">|</span> sex <span class="operator">|</span> birthday   <span class="operator">|</span> class <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> 曾华      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1977</span><span class="number">-09</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> 匡明      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1975</span><span class="number">-10</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span> <span class="operator">|</span> 王丽      <span class="operator">|</span> 女  <span class="operator">|</span> <span class="number">1976</span><span class="number">-01</span><span class="number">-23</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span> <span class="operator">|</span> 李军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1976</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span> <span class="operator">|</span> 王芳      <span class="operator">|</span> 女  <span class="operator">|</span> <span class="number">1975</span><span class="number">-02</span><span class="number">-10</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">106</span> <span class="operator">|</span> 陆军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">107</span> <span class="operator">|</span> 王尼玛    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1976</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">108</span> <span class="operator">|</span> 张全蛋    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1975</span><span class="number">-02</span><span class="number">-10</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span> <span class="operator">|</span> 赵铁柱    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">110</span> <span class="operator">|</span> 张飞      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95038</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 只查询性别为男，然后按 class 分组，并限制 class 行大于 1。</span></span><br><span class="line"><span class="keyword">SELECT</span> class <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> class <span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> class <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+</span></span><br></pre></td></tr></table></figure>
<h3 id="notlike-模糊查询取反">NOTLIKE 模糊查询取反</h3>
<p><strong>查询 <code>student</code> 表中不姓 “王” 的同学记录。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- NOT: 取反</span></span><br><span class="line"><span class="comment">-- LIKE: 模糊查询</span></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;王%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>  <span class="operator">|</span> name      <span class="operator">|</span> sex <span class="operator">|</span> birthday   <span class="operator">|</span> class <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> 曾华      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1977</span><span class="number">-09</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> 匡明      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1975</span><span class="number">-10</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span> <span class="operator">|</span> 李军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1976</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">106</span> <span class="operator">|</span> 陆军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">108</span> <span class="operator">|</span> 张全蛋    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1975</span><span class="number">-02</span><span class="number">-10</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span> <span class="operator">|</span> 赵铁柱    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">110</span> <span class="operator">|</span> 张飞      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95038</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br></pre></td></tr></table></figure>
<h3 id="year-与-now-函数">YEAR 与 NOW 函数</h3>
<p><strong>查询 <code>student</code> 表中每个学生的姓名和年龄。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用函数 YEAR(NOW()) 计算出当前年份，减去出生年份后得出年龄。</span></span><br><span class="line"><span class="keyword">SELECT</span> name, <span class="keyword">YEAR</span>(NOW()) <span class="operator">-</span> <span class="keyword">YEAR</span>(birthday) <span class="keyword">as</span> age <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+------+</span></span><br><span class="line"><span class="operator">|</span> name      <span class="operator">|</span> age  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+------+</span></span><br><span class="line"><span class="operator">|</span> 曾华      <span class="operator">|</span>   <span class="number">42</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 匡明      <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王丽      <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 李军      <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王芳      <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 陆军      <span class="operator">|</span>   <span class="number">45</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王尼玛    <span class="operator">|</span>   <span class="number">43</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 张全蛋    <span class="operator">|</span>   <span class="number">44</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span>   <span class="number">45</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 张飞      <span class="operator">|</span>   <span class="number">45</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+------+</span></span><br></pre></td></tr></table></figure>
<h3 id="max-与-min-函数">MAX 与 MIN 函数</h3>
<p><strong>查询 <code>student</code> 表中最大和最小的 <code>birthday</code> 值。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(birthday), <span class="built_in">MIN</span>(birthday) <span class="keyword">FROM</span> student;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">MAX</span>(birthday) <span class="operator">|</span> <span class="built_in">MIN</span>(birthday) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1977</span><span class="number">-09</span><span class="number">-01</span>    <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+---------------+</span></span><br></pre></td></tr></table></figure>
<h3 id="多段排序">多段排序</h3>
<p><strong>以 <code>class</code> 和 <code>birthday</code> 从大到小的顺序查询 <code>student</code> 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student <span class="keyword">ORDER</span> <span class="keyword">BY</span> class <span class="keyword">DESC</span>, birthday;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>  <span class="operator">|</span> name      <span class="operator">|</span> sex <span class="operator">|</span> birthday   <span class="operator">|</span> class <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">110</span> <span class="operator">|</span> 张飞      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95038</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span> <span class="operator">|</span> 王丽      <span class="operator">|</span> 女  <span class="operator">|</span> <span class="number">1976</span><span class="number">-01</span><span class="number">-23</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span> <span class="operator">|</span> 李军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1976</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">107</span> <span class="operator">|</span> 王尼玛    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1976</span><span class="number">-02</span><span class="number">-20</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span> <span class="operator">|</span> 曾华      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1977</span><span class="number">-09</span><span class="number">-01</span> <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">106</span> <span class="operator">|</span> 陆军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span> <span class="operator">|</span> 赵铁柱    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1974</span><span class="number">-06</span><span class="number">-03</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span> <span class="operator">|</span> 王芳      <span class="operator">|</span> 女  <span class="operator">|</span> <span class="number">1975</span><span class="number">-02</span><span class="number">-10</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">108</span> <span class="operator">|</span> 张全蛋    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1975</span><span class="number">-02</span><span class="number">-10</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span> <span class="operator">|</span> 匡明      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">1975</span><span class="number">-10</span><span class="number">-02</span> <span class="operator">|</span> <span class="number">95031</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+-----------+-----+------------+-------+</span></span><br></pre></td></tr></table></figure>
<h3 id="子查询-5">子查询 - 5</h3>
<p><strong>查询 “男” 教师及其所上的课程。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> t_no <span class="keyword">in</span> (<span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> teacher <span class="keyword">WHERE</span> sex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">no</span>    <span class="operator">|</span> name         <span class="operator">|</span> t_no <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> 操作系统     <span class="operator">|</span> <span class="number">804</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> 数字电路     <span class="operator">|</span> <span class="number">856</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+--------------+------+</span></span><br></pre></td></tr></table></figure>
<h3 id="max-函数与子查询">MAX 函数与子查询</h3>
<p><strong>查询最高分同学的 <code>score</code> 表。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 找出最高成绩（该查询只能有一个结果）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MAX</span>(degree) <span class="keyword">FROM</span> score;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据上面的条件筛选出所有最高成绩表，</span></span><br><span class="line"><span class="comment">-- 该查询可能有多个结果，假设 degree 值多次符合条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> degree <span class="operator">=</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(degree) <span class="keyword">FROM</span> score);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">92</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="子查询-6">子查询 - 6</h3>
<p><strong>查询和 “李军” 同性别的所有同学 <code>name</code> 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 首先将李军的性别作为条件取出来</span></span><br><span class="line"><span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;李军&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----+</span></span><br><span class="line"><span class="operator">|</span> sex <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+</span></span><br><span class="line"><span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 根据性别查询 name 和 sex</span></span><br><span class="line"><span class="keyword">SELECT</span> name, sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;李军&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> name      <span class="operator">|</span> sex <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----+</span></span><br><span class="line"><span class="operator">|</span> 曾华      <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 匡明      <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 李军      <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 陆军      <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王尼玛    <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 张全蛋    <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 赵铁柱    <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 张飞      <span class="operator">|</span> 男  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----+</span></span><br></pre></td></tr></table></figure>
<h3 id="子查询-7">子查询 - 7</h3>
<p><strong>查询和 “李军” 同性别且同班的同学 <code>name</code> 。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, sex, class <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> sex <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;李军&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> class <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> class <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;李军&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----+-------+</span></span><br><span class="line"><span class="operator">|</span> name      <span class="operator">|</span> sex <span class="operator">|</span> class <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----+-------+</span></span><br><span class="line"><span class="operator">|</span> 曾华      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 李军      <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> 王尼玛    <span class="operator">|</span> 男  <span class="operator">|</span> <span class="number">95033</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----+-------+</span></span><br></pre></td></tr></table></figure>
<h3 id="子查询-8">子查询 - 8</h3>
<p><strong>查询所有选修 “计算机导论” 课程的 “男” 同学成绩表。</strong></p>
<p>需要的 “计算机导论” 和性别为 “男” 的编号可以在 <code>course</code> 和 <code>student</code> 表中找到。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> score <span class="keyword">WHERE</span> c_no <span class="operator">=</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> course <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;计算机导论&#x27;</span></span><br><span class="line">) <span class="keyword">AND</span> s_no <span class="keyword">IN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> <span class="keyword">no</span> <span class="keyword">FROM</span> student <span class="keyword">WHERE</span> sex <span class="operator">=</span> <span class="string">&#x27;男&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> degree <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">90</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">91</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">89</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span>     <span class="number">76</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<h3 id="按等级查询">按等级查询</h3>
<p>建立一个 <code>grade</code> 表代表学生的成绩等级，并插入数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> grade (</span><br><span class="line">    low <span class="type">INT</span>(<span class="number">3</span>),</span><br><span class="line">    upp <span class="type">INT</span>(<span class="number">3</span>),</span><br><span class="line">    grade <span class="type">char</span>(<span class="number">1</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">90</span>, <span class="number">100</span>, <span class="string">&#x27;A&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">80</span>, <span class="number">89</span>, <span class="string">&#x27;B&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">70</span>, <span class="number">79</span>, <span class="string">&#x27;C&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">60</span>, <span class="number">69</span>, <span class="string">&#x27;D&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> grade <span class="keyword">VALUES</span> (<span class="number">0</span>, <span class="number">59</span>, <span class="string">&#x27;E&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> grade;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+-------+</span></span><br><span class="line"><span class="operator">|</span> low  <span class="operator">|</span> upp  <span class="operator">|</span> grade <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+-------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">90</span> <span class="operator">|</span>  <span class="number">100</span> <span class="operator">|</span> A     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">80</span> <span class="operator">|</span>   <span class="number">89</span> <span class="operator">|</span> B     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">70</span> <span class="operator">|</span>   <span class="number">79</span> <span class="operator">|</span> C     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">60</span> <span class="operator">|</span>   <span class="number">69</span> <span class="operator">|</span> D     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">0</span> <span class="operator">|</span>   <span class="number">59</span> <span class="operator">|</span> E     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+-------+</span></span><br></pre></td></tr></table></figure>
<p><strong>查询所有学生的 <code>s_no</code> 、<code>c_no</code> 和 <code>grade</code> 列。</strong></p>
<p>思路是，使用区间 ( <code>BETWEEN</code> ) 查询，判断学生的成绩 ( <code>degree</code> )  在 <code>grade</code> 表的 <code>low</code> 和 <code>upp</code> 之间。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s_no, c_no, grade <span class="keyword">FROM</span> score, grade </span><br><span class="line"><span class="keyword">WHERE</span> degree <span class="keyword">BETWEEN</span> low <span class="keyword">AND</span> upp;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+-------+</span></span><br><span class="line"><span class="operator">|</span> s_no <span class="operator">|</span> c_no  <span class="operator">|</span> grade <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">101</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> A     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">102</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> A     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> A     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> B     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">103</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> B     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">104</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> B     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> B     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> C     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">105</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> C     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-105</span> <span class="operator">|</span> C     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">3</span><span class="number">-245</span> <span class="operator">|</span> D     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">109</span>  <span class="operator">|</span> <span class="number">6</span><span class="number">-166</span> <span class="operator">|</span> B     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+-------+</span></span><br></pre></td></tr></table></figure>
<h3 id="连接查询">连接查询</h3>
<p>准备用于测试连接查询的数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE testJoin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> person (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    cardId <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> card (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> card <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;饭卡&#x27;</span>), (<span class="number">2</span>, <span class="string">&#x27;建行卡&#x27;</span>), (<span class="number">3</span>, <span class="string">&#x27;农行卡&#x27;</span>), (<span class="number">4</span>, <span class="string">&#x27;工商卡&#x27;</span>), (<span class="number">5</span>, <span class="string">&#x27;邮政卡&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> card;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 建行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> 工商卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> 邮政卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> person <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="number">3</span>), (<span class="number">3</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="number">6</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> person;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> cardId <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 张三   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 李四   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 王五   <span class="operator">|</span>      <span class="number">6</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+</span></span><br></pre></td></tr></table></figure>
<p>分析两张表发现，<code>person</code> 表并没有为 <code>cardId</code> 字段设置一个在 <code>card</code> 表中对应的 <code>id</code> 外键。如果设置了的话，<code>person</code> 中 <code>cardId</code> 字段值为 <code>6</code> 的行就插不进去，因为该 <code>cardId</code> 值在 <code>card</code> 表中并没有。</p>
<h4 id="内连接">内连接</h4>
<p>要查询这两张表中有关系的数据，可以使用 <code>INNER JOIN</code> ( 内连接 ) 将它们连接在一起。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- INNER JOIN: 表示为内连接，将两张表拼接在一起。</span></span><br><span class="line"><span class="comment">-- on: 表示要执行某个条件。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> person <span class="keyword">INNER</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId <span class="operator">=</span> card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 张三   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 李四   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将 INNER 关键字省略掉，结果也是一样的。</span></span><br><span class="line"><span class="comment">-- SELECT * FROM person JOIN card on person.cardId = card.id;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<code>card</code> 的整张表被连接到了右边。</p>
</blockquote>
<h4 id="左外连接">左外连接</h4>
<p>完整显示左边的表 ( <code>person</code> ) ，右边的表如果符合条件就显示，不符合则补 <code>NULL</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- LEFT JOIN 也叫做 LEFT OUTER JOIN，用这两种方式的查询结果是一样的。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> person <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId <span class="operator">=</span> card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 张三   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 李四   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 王五   <span class="operator">|</span>      <span class="number">6</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br></pre></td></tr></table></figure>
<h4 id="右外链接">右外链接</h4>
<p>完整显示右边的表 ( <code>card</code> ) ，左边的表如果符合条件就显示，不符合则补 <code>NULL</code> 。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> person <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId <span class="operator">=</span> card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 张三   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 李四   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 建行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> 工商卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> 邮政卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br></pre></td></tr></table></figure>
<h4 id="全外链接">全外链接</h4>
<p>完整显示两张表的全部数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL 不支持这种语法的全外连接</span></span><br><span class="line"><span class="comment">-- SELECT * FROM person FULL JOIN card on person.cardId = card.id;</span></span><br><span class="line"><span class="comment">-- 出现错误：</span></span><br><span class="line"><span class="comment">-- ERROR 1054 (42S22): Unknown column &#x27;person.cardId&#x27; in &#x27;on clause&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL全连接语法，使用 UNION 将两张表合并在一起。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> person <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId <span class="operator">=</span> card.id</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> person <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> card <span class="keyword">on</span> person.cardId <span class="operator">=</span> card.id;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span> id   <span class="operator">|</span> name   <span class="operator">|</span> cardId <span class="operator">|</span> id   <span class="operator">|</span> name      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 张三   <span class="operator">|</span>      <span class="number">1</span> <span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span> 饭卡      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 李四   <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 农行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">3</span> <span class="operator">|</span> 王五   <span class="operator">|</span>      <span class="number">6</span> <span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">2</span> <span class="operator">|</span> 建行卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">4</span> <span class="operator">|</span> 工商卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">NULL</span> <span class="operator">|</span> <span class="keyword">NULL</span>   <span class="operator">|</span>   <span class="keyword">NULL</span> <span class="operator">|</span>    <span class="number">5</span> <span class="operator">|</span> 邮政卡    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+--------+--------+------+-----------+</span></span><br></pre></td></tr></table></figure>
<h2 id="事务">事务</h2>
<p>在 MySQL 中，事务其实是一个最小的不可分割的工作单元。事务能够<strong>保证一个业务的完整性</strong>。</p>
<p>比如我们的银行转账：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- a -&gt; -100</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- b -&gt; +100</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在实际项目中，假设只有一条 SQL 语句执行成功，而另外一条执行失败了，就会出现数据前后不一致。</p>
<p>因此，在执行多条有关联 SQL 语句时，<strong>事务</strong>可能会要求这些 SQL 语句要么同时执行成功，要么就都执行失败。</p>
<h3 id="如何控制事务-commit-rollback">如何控制事务 - COMMIT / ROLLBACK</h3>
<p>在 MySQL 中，事务的<strong>自动提交</strong>状态默认是开启的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询事务的自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@AUTOCOMMIT</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@AUTOCOMMIT</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>            <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br></pre></td></tr></table></figure>
<p><strong>自动提交的作用</strong>：当我们执行一条 SQL 语句的时候，其产生的效果就会立即体现出来，且不能<strong>回滚</strong>。</p>
<p>什么是回滚？举个例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE bank;</span><br><span class="line"></span><br><span class="line">USE bank;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span> (</span><br><span class="line">    id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">    money <span class="type">INT</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<p>可以看到，在执行插入语句后数据立刻生效，原因是 MySQL 中的事务自动将它<strong>提交</strong>到了数据库中。那么所谓<strong>回滚</strong>的意思就是，撤销执行过的所有 SQL 语句，使其回滚到<strong>最后一次提交</strong>数据时的状态。</p>
<p>在 MySQL 中使用 <code>ROLLBACK</code> 执行回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 回滚到最后一次提交</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<p>由于所有执行过的 SQL 语句都已经被提交过了，所以数据并没有发生回滚。那如何让数据可以发生回滚？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 关闭自动提交</span></span><br><span class="line"><span class="keyword">SET</span> AUTOCOMMIT <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询自动提交状态</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@AUTOCOMMIT</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@AUTOCOMMIT</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br><span class="line"><span class="operator">|</span>            <span class="number">0</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------+</span></span><br></pre></td></tr></table></figure>
<p>将自动提交关闭后，测试数据回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭 AUTOCOMMIT 后，数据的变化是在一张虚拟的临时数据表中展示，</span></span><br><span class="line"><span class="comment">-- 发生变化的数据并没有真正插入到数据表中。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 数据表中的真实数据其实还是：</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于数据还没有真正提交，可以使用回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查询</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<p>那如何将虚拟的数据真正提交到数据库中？使用 <code>COMMIT</code> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">-- 手动提交数据（持久性），</span></span><br><span class="line"><span class="comment">-- 将数据真正提交到数据库中，执行后不能再回滚提交过的数据。</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交后测试回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 再次查询（回滚无效了）</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>总结</strong></p>
<ol>
<li>
<p><strong>自动提交</strong></p>
<ul>
<li>
<p>查看自动提交状态：<code>SELECT @@AUTOCOMMIT</code> ；</p>
</li>
<li>
<p>设置自动提交状态：<code>SET AUTOCOMMIT = 0</code> 。</p>
</li>
</ul>
</li>
<li>
<p><strong>手动提交</strong></p>
<p><code>@@AUTOCOMMIT = 0</code> 时，使用 <code>COMMIT</code> 命令提交事务。</p>
</li>
<li>
<p><strong>事务回滚</strong></p>
<p><code>@@AUTOCOMMIT = 0</code> 时，使用 <code>ROLLBACK</code> 命令回滚事务。</p>
</li>
</ol>
</blockquote>
<p><strong>事务的实际应用</strong>，让我们再回到银行转账项目：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 转账</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 到账</span></span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<p>这时假设在转账时发生了意外，就可以使用 <code>ROLLBACK</code> 回滚到最后一次提交的状态：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 假设转账发生了意外，需要回滚。</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<p>这时我们又回到了发生意外之前的状态，也就是说，事务给我们提供了一个可以反悔的机会。假设数据没有发生意外，这时可以手动将数据真正提交到数据表中：<code>COMMIT</code> 。</p>
<h3 id="手动开启事务-begin-start-transaction">手动开启事务 - BEGIN / START TRANSACTION</h3>
<p>事务的默认提交被开启 ( <code>@@AUTOCOMMIT = 1</code> ) 后，此时就不能使用事务回滚了。但是我们还可以手动开启一个事务处理事件，使其可以发生回滚：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用 BEGIN 或者 START TRANSACTION 手动开启一个事务</span></span><br><span class="line"><span class="comment">-- START TRANSACTION;</span></span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 由于手动开启的事务没有开启自动提交，</span></span><br><span class="line"><span class="comment">-- 此时发生变化的数据仍然是被保存在一张临时表中。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试回滚</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br></pre></td></tr></table></figure>
<p>仍然使用 <code>COMMIT</code> 提交数据，提交后无法再发生本次事务的回滚。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">set</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">100</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a    <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b    <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 提交数据</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 测试回滚（无效，因为表的数据已经被提交）</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>
<h3 id="事务的-acid-特征与使用">事务的 ACID 特征与使用</h3>
<p><strong>事务的四大特征：</strong></p>
<ul>
<li><strong>A 原子性</strong>：事务是最小的单位，不可以再分割；</li>
<li><strong>C 一致性</strong>：要求同一事务中的 SQL 语句，必须保证同时成功或者失败；</li>
<li><strong>I 隔离性</strong>：事务1 和 事务2 之间是具有隔离性的；</li>
<li><strong>D 持久性</strong>：事务一旦结束 ( <code>COMMIT</code> ) ，就不可以再返回了 ( <code>ROLLBACK</code> ) 。</li>
</ul>
<h3 id="事务的隔离性">事务的隔离性</h3>
<p><strong>事务的隔离性可分为四种 ( 性能从低到高 )</strong> ：</p>
<ol>
<li>
<p><strong>READ UNCOMMITTED ( 读取未提交 )</strong></p>
<p>如果有多个事务，那么任意事务都可以看见其他事务的<strong>未提交数据</strong>。</p>
</li>
<li>
<p><strong>READ COMMITTED ( 读取已提交 )</strong></p>
<p>只能读取到其他事务<strong>已经提交的数据</strong>。</p>
</li>
<li>
<p><strong>REPEATABLE READ ( 可被重复读 )</strong></p>
<p>如果有多个连接都开启了事务，那么事务之间不能共享数据记录，否则只能共享已提交的记录。</p>
</li>
<li>
<p><strong>SERIALIZABLE ( 串行化 )</strong></p>
<p>所有的事务都会按照<strong>固定顺序执行</strong>，执行完一个事务后再继续执行下一个事务的<strong>写入操作</strong>。</p>
</li>
</ol>
<p>查看当前数据库的默认隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- MySQL 8.x, GLOBAL 表示系统级别，不加表示会话级别。</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@TRANSACTION</span>_ISOLATION;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ                <span class="operator">|</span> <span class="comment">-- MySQL的默认隔离级别，可以重复读。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 5.x</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.TX_ISOLATION;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@TX</span>_ISOLATION;</span><br></pre></td></tr></table></figure>
<p>修改隔离级别：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置系统隔离级别，LEVEL 后面表示要设置的隔离级别 (READ UNCOMMITTED)。</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询系统隔离级别，发现已经被修改。</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>UNCOMMITTED               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>
<h4 id="脏读">脏读</h4>
<p>测试 <strong>READ UNCOMMITTED ( 读取未提交 )</strong> 的隔离性：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;小明&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;淘宝店&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启一个事务操作数据</span></span><br><span class="line"><span class="comment">-- 假设小明在淘宝店买了一双800块钱的鞋子：</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">800</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">800</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;淘宝店&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 然后淘宝店在另一方查询结果，发现钱已到账。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>   <span class="number">200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>
<p>由于小明的转账是在新开启的事务上进行操作的，而该操作的结果是可以被其他事务（另一方的淘宝店）看见的，因此淘宝店的查询结果是正确的，淘宝店确认到账。但就在这时，如果小明在它所处的事务上又执行了 <code>ROLLBACK</code> 命令，会发生什么？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小明所处的事务</span></span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时无论对方是谁，如果再去查询结果就会发现：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>
<p>这就是所谓的<strong>脏读</strong>，一个事务读取到另外一个事务还未提交的数据。这在实际开发中是不允许出现的。</p>
<h4 id="读取已提交">读取已提交</h4>
<p>把隔离级别设置为 <strong>READ COMMITTED</strong> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> READ<span class="operator">-</span>COMMITTED                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>这样，再有新的事务连接进来时，它们就只能查询到已经提交过的事务数据了。但是对于当前事务来说，它们看到的还是未提交的数据，例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 正在操作数据事务（当前事务）</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money <span class="operator">=</span> money <span class="operator">-</span> <span class="number">800</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;小明&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span> <span class="keyword">SET</span> money <span class="operator">=</span> money <span class="operator">+</span> <span class="number">800</span> <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;淘宝店&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 虽然隔离级别被设置为了 READ COMMITTED，但在当前事务中，</span></span><br><span class="line"><span class="comment">-- 它看到的仍然是数据表中临时改变数据，而不是真正提交过的数据。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>   <span class="number">200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设此时在远程开启了一个新事务，连接到数据库。</span></span><br><span class="line">$ mysql <span class="operator">-</span>u root <span class="operator">-</span>p12345612</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时远程连接查询到的数据只能是已经提交过的</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>
<p>但是这样还有问题，那就是假设一个事务在操作数据时，其他事务干扰了这个事务的数据。例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小张在查询数据的时候发现：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>   <span class="number">200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在小张求表的 money 平均值之前，小王做了一个操作：</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">5</span>, <span class="string">&#x27;c&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 此时表的真实数据是：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> c         <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这时小张再求平均值的时候，就会出现计算不相符合的情况：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(money) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="built_in">AVG</span>(money) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">820.0000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------+</span></span><br></pre></td></tr></table></figure>
<p>虽然 <strong>READ COMMITTED</strong> 让我们只能读取到其他事务已经提交的数据，但还是会出现问题，就是<strong>在读取同一个表的数据时，可能会发生前后不一致的情况。<strong>这被称为</strong>不可重复读现象 ( READ COMMITTED )</strong> 。</p>
<h4 id="幻读">幻读</h4>
<p>将隔离级别设置为 <strong>REPEATABLE READ ( 可被重复读取 )</strong> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL REPEATABLE READ;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>测试 <strong>REPEATABLE READ</strong> ，假设在两个不同的连接上分别执行 <code>START TRANSACTION</code> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小张 - 成都</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">&#x27;d&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 小王 - 北京</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 小张 - 成都</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>
<p>当前事务开启后，没提交之前，查询不到，提交后可以被查询到。但是，在提交之前其他事务被开启了，那么在这条事务线上，就不会查询到当前有操作事务的连接。相当于开辟出一条单独的线程。</p>
<p>无论小张是否执行过 <code>COMMIT</code> ，在小王这边，都不会查询到小张的事务记录，而是只会查询到自己所处事务的记录：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> c         <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br></pre></td></tr></table></figure>
<p>这是 <strong>因为小王在此之前开启了一个新的事务 ( <code>START TRANSACTION</code> )</strong>，那么<strong>在他的这条新事务的线上，跟其他事务是没有联系的</strong>，也就是说，此时如果其他事务正在操作数据，它是不知道的。</p>
<p>然而事实是，在真实的数据表中，小张已经插入了一条数据。但是小王此时并不知道，也插入了同一条数据，会发生什么呢？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">6</span>, <span class="string">&#x27;d&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">-- ERROR 1062 (23000): Duplicate entry &#x27;6&#x27; for key &#x27;PRIMARY&#x27;</span></span><br></pre></td></tr></table></figure>
<p>报错了，操作被告知已存在主键为 <code>6</code> 的字段。这种现象也被称为<strong>幻读，一个事务提交的数据，不能被其他事务读取到</strong>。</p>
<h4 id="串行化">串行化</h4>
<p>顾名思义，就是所有事务的<strong>写入操作</strong>全都是串行化的。什么意思？把隔离级别修改成 <strong>SERIALIZABLE</strong> :</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> @<span class="variable">@GLOBAL</span>.TRANSACTION_ISOLATION <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br><span class="line"><span class="operator">|</span> SERIALIZABLE                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>
<p>还是拿小张和小王来举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 小张 - 成都</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 小王 - 北京</span></span><br><span class="line"><span class="keyword">START</span> TRANSACTION;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 开启事务之前先查询表，准备操作数据。</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name      <span class="operator">|</span> money <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> a         <span class="operator">|</span>   <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> b         <span class="operator">|</span>  <span class="number">1100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> 小明      <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> 淘宝店    <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> c         <span class="operator">|</span>   <span class="number">100</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">6</span> <span class="operator">|</span> d         <span class="operator">|</span>  <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 发现没有 7 号王小花，于是插入一条数据：</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span> <span class="keyword">VALUES</span> (<span class="number">7</span>, <span class="string">&#x27;王小花&#x27;</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p>此时会发生什么呢？由于现在的隔离级别是 <strong>SERIALIZABLE ( 串行化 )</strong> ，串行化的意思就是：假设把所有的事务都放在一个串行的队列中，那么所有的事务都会按照<strong>固定顺序执行</strong>，执行完一个事务后再继续执行下一个事务的<strong>写入操作</strong> ( <strong>这意味着队列中同时只能执行一个事务的写入操作</strong> ) 。</p>
<p>根据这个解释，小王在插入数据时，会出现等待状态，直到小张执行 <code>COMMIT</code> 结束它所处的事务，或者出现等待超时。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://whut-zhangwx.github.io">文羊羽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://whut-zhangwx.github.io/database-mysql/">https://whut-zhangwx.github.io/database-mysql/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://whut-zhangwx.github.io" target="_blank">文羊羽</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="/white" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">MySQL安装配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">基本语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">MySQL常用数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E8%A1%A8%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.</span> <span class="toc-text">建表约束</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.1.</span> <span class="toc-text">主键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%94%AF%E4%B8%80%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.2.</span> <span class="toc-text">唯一约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E7%A9%BA%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.3.</span> <span class="toc-text">非空约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.4.</span> <span class="toc-text">默认约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">4.5.</span> <span class="toc-text">外键约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%89%E5%A4%A7%E8%AE%BE%E8%AE%A1%E8%8C%83%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">数据库的三大设计范式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1nf"><span class="toc-number">5.1.</span> <span class="toc-text">1NF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2nf"><span class="toc-number">5.2.</span> <span class="toc-text">2NF</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3nf"><span class="toc-number">5.3.</span> <span class="toc-text">3NF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BB%83%E4%B9%A0"><span class="toc-number">6.</span> <span class="toc-text">查询练习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">6.1.</span> <span class="toc-text">准备数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A01-%E5%88%B0-10"><span class="toc-number">6.2.</span> <span class="toc-text">练习1 到 10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%9D%87%E6%88%90%E7%BB%A9"><span class="toc-number">6.3.</span> <span class="toc-text">分组计算平均成绩</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9D%A1%E4%BB%B6%E4%B8%8E%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.4.</span> <span class="toc-text">分组条件与模糊查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">6.5.</span> <span class="toc-text">多表查询 - 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-2"><span class="toc-number">6.6.</span> <span class="toc-text">多表查询 - 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E8%A1%A8%E5%85%B3%E8%81%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.7.</span> <span class="toc-text">三表关联查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2%E5%8A%A0%E5%88%86%E7%BB%84%E6%B1%82%E5%B9%B3%E5%9D%87%E5%88%86"><span class="toc-number">6.8.</span> <span class="toc-text">子查询加分组求平均分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-1"><span class="toc-number">6.9.</span> <span class="toc-text">子查询 - 1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-2"><span class="toc-number">6.10.</span> <span class="toc-text">子查询 - 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#year-%E5%87%BD%E6%95%B0%E4%B8%8E%E5%B8%A6-in-%E5%85%B3%E9%94%AE%E5%AD%97%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.11.</span> <span class="toc-text">YEAR 函数与带 IN 关键字查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%B1%82%E5%B5%8C%E5%A5%97%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.12.</span> <span class="toc-text">多层嵌套子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.13.</span> <span class="toc-text">多表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-3"><span class="toc-number">6.14.</span> <span class="toc-text">子查询 - 3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#union-%E5%92%8C-notin-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.15.</span> <span class="toc-text">UNION 和 NOTIN 的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#any-%E8%A1%A8%E7%A4%BA%E8%87%B3%E5%B0%91%E4%B8%80%E4%B8%AA-desc-%E9%99%8D%E5%BA%8F"><span class="toc-number">6.16.</span> <span class="toc-text">ANY 表示至少一个 - DESC ( 降序 )</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E7%A4%BA%E6%89%80%E6%9C%89%E7%9A%84-all"><span class="toc-number">6.17.</span> <span class="toc-text">表示所有的 ALL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BD%9C%E4%B8%BA%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.18.</span> <span class="toc-text">复制表的数据作为条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-4"><span class="toc-number">6.19.</span> <span class="toc-text">子查询 - 4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%8A%A0%E7%BB%84%E7%AD%9B%E9%80%89"><span class="toc-number">6.20.</span> <span class="toc-text">条件加组筛选</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#notlike-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E5%8F%96%E5%8F%8D"><span class="toc-number">6.21.</span> <span class="toc-text">NOTLIKE 模糊查询取反</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#year-%E4%B8%8E-now-%E5%87%BD%E6%95%B0"><span class="toc-number">6.22.</span> <span class="toc-text">YEAR 与 NOW 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#max-%E4%B8%8E-min-%E5%87%BD%E6%95%B0"><span class="toc-number">6.23.</span> <span class="toc-text">MAX 与 MIN 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%AE%B5%E6%8E%92%E5%BA%8F"><span class="toc-number">6.24.</span> <span class="toc-text">多段排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-5"><span class="toc-number">6.25.</span> <span class="toc-text">子查询 - 5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#max-%E5%87%BD%E6%95%B0%E4%B8%8E%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.26.</span> <span class="toc-text">MAX 函数与子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-6"><span class="toc-number">6.27.</span> <span class="toc-text">子查询 - 6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-7"><span class="toc-number">6.28.</span> <span class="toc-text">子查询 - 7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-8"><span class="toc-number">6.29.</span> <span class="toc-text">子查询 - 8</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E7%AD%89%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.30.</span> <span class="toc-text">按等级查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.31.</span> <span class="toc-text">连接查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.31.1.</span> <span class="toc-text">内连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.31.2.</span> <span class="toc-text">左外连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%B3%E5%A4%96%E9%93%BE%E6%8E%A5"><span class="toc-number">6.31.3.</span> <span class="toc-text">右外链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%A4%96%E9%93%BE%E6%8E%A5"><span class="toc-number">6.31.4.</span> <span class="toc-text">全外链接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">7.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1-commit-rollback"><span class="toc-number">7.1.</span> <span class="toc-text">如何控制事务 - COMMIT &#x2F; ROLLBACK</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1-begin-start-transaction"><span class="toc-number">7.2.</span> <span class="toc-text">手动开启事务 - BEGIN &#x2F; START TRANSACTION</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84-acid-%E7%89%B9%E5%BE%81%E4%B8%8E%E4%BD%BF%E7%94%A8"><span class="toc-number">7.3.</span> <span class="toc-text">事务的 ACID 特征与使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7"><span class="toc-number">7.4.</span> <span class="toc-text">事务的隔离性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%84%8F%E8%AF%BB"><span class="toc-number">7.4.1.</span> <span class="toc-text">脏读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%B7%B2%E6%8F%90%E4%BA%A4"><span class="toc-number">7.4.2.</span> <span class="toc-text">读取已提交</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%BB%E8%AF%BB"><span class="toc-number">7.4.3.</span> <span class="toc-text">幻读</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">7.4.4.</span> <span class="toc-text">串行化</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 文羊羽</div><div class="footer_custom_text">Hi, welcome to my <a href="https://whut-zhangwx.github.io/">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'default' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>